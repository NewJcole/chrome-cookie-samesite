const e=/(^\w+:|^)\/\//,n=/^(?:[^@\/\n]+@)?(?:www\.)?([^:\/\n]+)/,o=/^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\\.)+[A-Za-z]{2,6}$/,r=/.[^.]*\.[^.]{2,3}(?:\.[^.]{2,3})?$/,t=["localhost","127.0.0.1"],a=new Map,l={enable:false,developMode:true};function u(){chrome.webRequest.onBeforeSendHeaders.addListener(s,{urls:["<all_urls>"]},["blocking","requestHeaders","extraHeaders"])}function s(e){const{initiator:u}=e;if(!l.developMode||function(e){var o;if(!e)return;const r=null===(o=i(e).match(n))||void 0===o?void 0:o[0];if(!r)return;return t.includes(r)}(u))return chrome.cookies.getAll({},(e=>{a.clear(),e.forEach((({domain:e,name:n,value:o})=>a.set(e,`${a.has(e)?`${a.get(e)};`:""}${n}=${o}`)))})),function(e){if(function(e){var n;return null===(n=e.requestHeaders)||void 0===n?void 0:n.some((({name:e})=>"Cookie"===e))}(e))return;const l=function(e){var a,l;if(t.includes(e))return e;const u=i(e),s=null===(a=u.match(n))||void 0===a?void 0:a[0];if(!s||(d=s,!d||!o.test(d)))return s;var d;return null===(l=s.match(r))||void 0===l?void 0:l[0]}(e.url);if(!l)return;let u=a.get(l);if(!u)return;e.requestHeaders||(e.requestHeaders=[]);return e.requestHeaders.push({name:"Cookie",value:u}),{requestHeaders:e.requestHeaders}}(e)}function i(n){return n.replace(e,"")}function d(e=!1){return`icon/${e?"cookie-enable":"cookie"}.png`}function c(e){chrome.browserAction.setIcon({path:d(e)})}chrome.storage.onChanged.addListener((function(e){if("developMode"in e){const n=e.developMode.newValue;l.developMode=n}if("enable"in e){const n=e.enable.newValue;l.enable=n,c(n),n?u():chrome.webRequest.onBeforeSendHeaders.removeListener(s)}})),chrome.storage.local.get(["enable","developMode"],(({enable:e,developMode:n})=>{const o=null!=e&&e,r=null==n||n;l.enable=o,l.developMode=r,c(o),chrome.storage.local.set({enable:o,developMode:r}),e&&u()}));

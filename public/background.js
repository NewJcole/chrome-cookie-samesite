const e=/(^\w+:|^)\/\//,o=/^(?:[^@\/\n]+@)?(?:www\.)?([^:\/\n]+)/,n=/.[^.]*\.[^.]{2,3}(?:\.[^.]{2,3})?$/,r=["localhost","127.0.0.1"],t=new Map,l={enable:false,developMode:true};function a(){chrome.webRequest.onBeforeSendHeaders.addListener(u,{urls:["<all_urls>"]},["blocking","requestHeaders","extraHeaders"])}function u(e){const{initiator:a}=e;if(console.log(l.developMode),!l.developMode||function(e){var n;if(!e)return;const t=null===(n=s(e).match(o))||void 0===n?void 0:n[0];if(!t)return;return r.includes(t)}(a))return chrome.cookies.getAll({},(e=>{t.clear(),e.forEach((({domain:e,name:o,value:n})=>t.set(e,`${t.has(e)?`${t.get(e)};`:""}${o}=${n}`)))})),function(e){if(function(e){var o;return null===(o=e.requestHeaders)||void 0===o?void 0:o.some((({name:e})=>"Cookie"===e))}(e))return;const r=function(e){var r,t;if("localhost"===e)return e;const l=s(e),a=null===(r=l.match(o))||void 0===r?void 0:r[0];if(!a)return;return null===(t=a.match(n))||void 0===t?void 0:t[0]}(e.url);if(!r)return;let l=t.get(r);if(!l)return;e.requestHeaders||(e.requestHeaders=[]);return e.requestHeaders.push({name:"Cookie",value:l}),{requestHeaders:e.requestHeaders}}(e)}function s(o){return o.replace(e,"")}function d(e=!1){return`icon/${e?"cookie-enable":"cookie"}.png`}function i(e){chrome.browserAction.setIcon({path:d(e)})}chrome.storage.onChanged.addListener((function(e){if("developMode"in e){const o=e.developMode.newValue;l.developMode=o}if("enable"in e){const o=e.enable.newValue;l.enable=o,i(o),o?a():chrome.webRequest.onBeforeSendHeaders.removeListener(u)}})),chrome.storage.local.get(["enable","developMode"],(({enable:e,developMode:o})=>{const n=null!=e&&e,r=null==o||o;l.enable=n,l.developMode=r,i(n),chrome.storage.local.set({enable:n,developMode:r}),e&&a()}));
